<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lswd.youpin.dao.lsyp.RecipePlanItemsMapper">
  <resultMap id="BaseResultMap" type="com.lswd.youpin.model.lsyp.RecipePlanItems">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="recipe_id" jdbcType="VARCHAR" property="recipeId" />
    <result column="recipe_plan_id" jdbcType="VARCHAR" property="recipePlanId" />
    <result column="recipe_type" jdbcType="SMALLINT" property="recipeType" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="price_day" jdbcType="REAL" property="priceDay"/>
    <result column="market_price_day" jdbcType="REAL" property="marketPriceDay"/>
    <result column="is_hot" jdbcType="TINYINT" property="isHot" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
    <result column="safetyone" jdbcType="VARCHAR" property="safetyone" />
    <result column="safetytwo" jdbcType="VARCHAR" property="safetytwo" />
  </resultMap>
  <sql id="Base_Column_List">
    id, recipe_id, recipe_plan_id, recipe_type, surplus,price_day,market_price_day,is_hot,is_delete,safetyone, safetytwo
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select   <include refid="Base_Column_List" /> from t_recipe_planitems where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from t_recipe_planitems  where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    insert into t_recipe_planitems (id, recipe_id, recipe_plan_id, recipe_type, surplus,price_day,market_price_day,is_hot,is_delete,safetyone, safetytwo)
    values (#{id,jdbcType=INTEGER}, #{recipeId,jdbcType=VARCHAR}, #{recipePlanId,jdbcType=VARCHAR}, #{recipeType,jdbcType=SMALLINT},#{surplus,jdbcType=INTEGER},
       #{priceDay,jdbcType=REAL},#{marketPriceDay,jdbcType=REAL},#{isHot,jdbcType=TINYINT},#{isDelete,jdbcType=TINYINT},
       #{safetyone,jdbcType=VARCHAR}, #{safetytwo,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    insert into t_recipe_planitems
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="recipeId != null">
        recipe_id,
      </if>
      <if test="recipePlanId != null">
        recipe_plan_id,
      </if>
      <if test="recipeType != null">
        recipe_type,
      </if>
      <if test="surplus != null">
        surplus,
      </if>
      <if test="price_day != null">
        price_day,
      </if>
      <if test="market_price_day != null">
        market_price_day,
      </if>
      <if test="isHot != null">
        is_hot,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
      <if test="safetyone != null">
        safetyone,
      </if>
      <if test="safetytwo != null">
        safetytwo,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="recipeId != null">
        #{recipeId,jdbcType=VARCHAR},
      </if>
      <if test="recipePlanId != null">
        #{recipePlanId,jdbcType=VARCHAR},
      </if>
      <if test="recipeType != null">
        #{recipeType,jdbcType=SMALLINT},
      </if>
      <if test="surplus != null">
        #{surplus,jdbcType=INTEGER},
      </if>
      <if test="priceDay != null">
        #{priceDay,jdbcType=REAL},
      </if>
      <if test="marketPriceDay != null">
        #{marketPriceDay,jdbcType=REAL},
      </if>
      <if test="isHot != null">
        #{isHot,jdbcType=TINYINT},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=TINYINT},
      </if>
      <if test="safetyone != null">
        #{safetyone,jdbcType=VARCHAR},
      </if>
      <if test="safetytwo != null">
        #{safetytwo,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    update t_recipe_planitems
    <set>
      <if test="recipeId != null">
        recipe_id = #{recipeId,jdbcType=VARCHAR},
      </if>
      <if test="recipePlanId != null">
        recipe_plan_id = #{recipePlanId,jdbcType=VARCHAR},
      </if>
      <if test="recipeType != null">
        recipe_type = #{recipeType,jdbcType=SMALLINT},
      </if>
      <if test="surplus != null">
        surplus = #{surplus,jdbcType=INTEGER},
      </if>
      <if test="priceDay != null">
        price_day = #{priceDay,jdbcType=REAL},
      </if>
      <if test="marketPriceDay != null">
        market_price_day = #{marketPriceDay,jdbcType=REAL},
      </if>
      <if test="isHot != null">
        is_hot = #{isHot,jdbcType=TINYINT},
      </if>
      <if test="isDelete != null">
        is_delete = #{isDelete,jdbcType=TINYINT},
      </if>
      <if test="safetyone != null">
        safetyone = #{safetyone,jdbcType=VARCHAR},
      </if>
      <if test="safetytwo != null">
        safetytwo = #{safetytwo,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    update t_recipe_planitems
    set recipe_id = #{recipeId,jdbcType=VARCHAR},
      recipe_plan_id = #{recipePlanId,jdbcType=VARCHAR},
      recipe_type = #{recipeType,jdbcType=SMALLINT},
      surplus = #{surplus,jdbcType=INTEGER},
      price_day = #{priceDay,jdbcType=REAL},
      market_price_day = #{marketPriceDay,jdbcType=REAL},
      is_hot = #{isHot,jdbcType=TINYINT},
      is_delete = #{isDelete,jdbcType=TINYINT},
      safetyone = #{safetyone,jdbcType=VARCHAR},
      safetytwo = #{safetytwo,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <!--zhenguanqi write-->
  <insert id="insertPlanItems" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    insert into t_recipe_planitems (recipe_id, recipe_plan_id,recipe_type,surplus,price_day,market_price_day,is_hot)
    values (#{recipeId,jdbcType=VARCHAR}, #{recipePlanId,jdbcType=VARCHAR},#{recipeType,jdbcType=SMALLINT},#{surplus,jdbcType=INTEGER},#{priceDay,jdbcType=REAL},#{marketPriceDay,jdbcType=REAL},#{isHot,jdbcType=TINYINT})
  </insert>

  <update id="updatePlanItemsSurplus" parameterType="com.lswd.youpin.model.lsyp.RecipePlanItems">
    update t_recipe_planitems  set surplus = #{surplus,jdbcType=INTEGER},price_day = #{priceDay,jdbcType=REAL},
      market_price_day = #{marketPriceDay,jdbcType=REAL},is_hot = #{isHot,jdbcType=TINYINT} where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="getRecipePlanItemsCount" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(id) from t_recipe_planitems where  recipe_plan_id = #{recipePlanId}
  </select>

  <resultMap id="getPlanItemsByRecipePlanIdMap" type="com.lswd.youpin.model.lsyp.RecipePlanItems">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="recipe_id" jdbcType="VARCHAR" property="recipeId" />
    <result column="recipe_plan_id" jdbcType="VARCHAR" property="recipePlanId" />
    <result column="recipe_type" jdbcType="SMALLINT" property="recipeType" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="price_day" jdbcType="REAL" property="priceDay"/>
    <result column="market_price_day" jdbcType="REAL" property="marketPriceDay"/>
    <result column="is_hot" jdbcType="TINYINT" property="isHot" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
   <association property="recipe" javaType="com.lswd.youpin.model.lsyp.Recipe">
     <id column="re_id" jdbcType="INTEGER" property="id" />
     <result column="re_recipe_name" jdbcType="VARCHAR" property="recipeName" />
     <result column="re_recipe_id" jdbcType="VARCHAR" property="recipeId" />
     <result column="re_imageurl" jdbcType="VARCHAR" property="imageurl" />
   </association>
  </resultMap>

  <select id="getPlanItemsByRecipePlanId"  resultMap="getPlanItemsByRecipePlanIdMap">
    select items.id,items.recipe_id,items.recipe_plan_id,items.recipe_type,items.surplus,items.price_day,items.market_price_day,items.is_hot,
     recipe.id re_id,recipe.recipe_name re_recipe_name,recipe.recipe_id re_recipe_id,recipe.imageurl re_imageurl
    from t_recipe_planitems items
    INNER JOIN t_recipe recipe ON recipe.recipe_id = items.recipe_id
    where  recipe_plan_id =  #{recipePlanId}
  </select>

  <resultMap id="getRecipePlanItemsListMap" type="com.lswd.youpin.model.lsyp.RecipePlanItems">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="recipe_id" jdbcType="VARCHAR" property="recipeId" />
    <result column="recipe_plan_id" jdbcType="VARCHAR" property="recipePlanId" />
    <result column="recipe_type" jdbcType="SMALLINT" property="recipeType" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="price_day" jdbcType="REAL" property="priceDay"/>
    <result column="market_price_day" jdbcType="REAL" property="marketPriceDay"/>
    <result column="is_hot" jdbcType="TINYINT" property="isHot" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
    <association property="recipe" javaType="com.lswd.youpin.model.lsyp.Recipe">
      <id column="r_id" jdbcType="INTEGER" property="id" />
      <result column="r_recipe_name" jdbcType="VARCHAR" property="recipeName" />
      <result column="r_recipe_id" jdbcType="VARCHAR" property="recipeId" />
      <result column="r_imageurl" jdbcType="VARCHAR" property="imageurl" />
    </association>
  </resultMap>

  <select id="getRecipePlanItemsList"  resultMap="getRecipePlanItemsListMap">
    select
    items.id,items.recipe_id,items.recipe_plan_id,items.recipe_type,items.price_day,items.market_price_day,items.is_hot,
    recipe.surplus,recipe.id r_id,recipe.recipe_name r_recipe_name,recipe.recipe_id r_recipe_id,recipe.imageurl r_imageurl
    from t_recipe_planitems items INNER JOIN t_recipe recipe ON items.recipe_id = recipe.recipe_id
    where  recipe_plan_id =  #{recipePlanId}
  </select>

  <select id="getRPIListByCanteenAndEatTimeAndType"  resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"></include> from t_recipe_planitems
    where  recipe_plan_id =  #{recipePlanId}
  </select>

  <delete id="deletePlanItemsByRecipePlanIdTrue" parameterType="java.lang.String">
    delete from t_recipe_planitems where recipe_plan_id = #{recipePlanId}
  </delete>

  <delete id="deleteRecipePlanOneRecipeTrue">
    delete from t_recipe_planitems where recipe_plan_id = #{recipePlanId} AND recipe_id = #{recipeId} AND recipe_type = #{recipeType}
  </delete>

  <update id="deletePlanItemsByRecipePlanIdIsDelete" parameterType="java.lang.String">
    update t_recipe_planitems  set is_delete = 1 where recipe_plan_id = #{recipePlanId}
  </update>

  <select id="getRecipeByRecipePlanIdAndRecipeType"  resultMap="BaseResultMap">
    select id,recipe_id,recipe_plan_id,recipe_type,surplus,price_day,market_price_day,is_delete,is_hot from t_recipe_planitems
    where  recipe_plan_id =  #{recipePlanId} AND recipe_type = #{recipeType} AND is_delete = 0
  </select>

  <!--*******************************************************以下方法是H5前段页面需要用到的方法*******************************************************-->
  <select id="getItemsByPlanIdAndTypeAndCateCount" resultType="java.lang.Integer">
    select count(1)  from t_recipe_planitems items  LEFT JOIN t_recipe recipe  ON items.recipe_id = recipe.recipe_id
    where  items.recipe_plan_id =  #{recipePlanId} AND recipe.status = 0 AND recipe.is_delete = 0
    <if test="keyword != ''">
      AND recipe.recipe_name LIKE #{keyword}
    </if>
    <if test="eatType != null">
      AND items.recipe_type = #{eatType}
    </if>
    <if test="categoryId != 0">
      AND recipe.category_id = #{categoryId}
    </if>
  </select>

  <resultMap id="getItemsByPlanIdAndTypeAndCateMap" type="com.lswd.youpin.model.lsyp.RecipePlanItems">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="recipe_id" jdbcType="VARCHAR" property="recipeId" />
    <result column="recipe_plan_id" jdbcType="VARCHAR" property="recipePlanId" />
    <result column="recipe_type" jdbcType="SMALLINT" property="recipeType" />
    <result column="price_day" jdbcType="REAL" property="priceDay"/>
    <result column="market_price_day" jdbcType="REAL" property="marketPriceDay"/>
    <result column="is_hot" jdbcType="TINYINT" property="isHot" />
    <association property="recipe" javaType="com.lswd.youpin.model.lsyp.Recipe">
      <id column="r_id" jdbcType="INTEGER" property="id" />
      <result column="r_recipe_name" jdbcType="VARCHAR" property="recipeName" />
      <result column="r_recipe_id" jdbcType="VARCHAR" property="recipeId" />
      <result column="r_imageurl" jdbcType="VARCHAR" property="imageurl" />
      <result column="r_guide_price" jdbcType="REAL" property="guidePrice" />
      <result column="r_market_price" jdbcType="REAL" property="marketPrice" />
      <result column="r_category_id" jdbcType="INTEGER" property="categoryId" />
    </association>
  </resultMap>

  <select id="getItemsByPlanIdAndTypeAndCate"  resultMap="getItemsByPlanIdAndTypeAndCateMap">
    select items.id,items.surplus,items.recipe_id,items.recipe_plan_id,items.recipe_type,items.price_day,items.market_price_day,items.is_hot,
      recipe.id r_id,recipe.recipe_name r_recipe_name,recipe.recipe_id r_recipe_id,recipe.imageurl r_imageurl,recipe.guide_price r_guide_price,recipe.market_price r_market_price,
      recipe.category_id r_category_id
    from t_recipe_planitems items
    LEFT JOIN t_recipe recipe  ON items.recipe_id = recipe.recipe_id
    where  items.recipe_plan_id =  #{recipePlanId} AND recipe.status = 0 AND recipe.is_delete = 0
    <if test="keyword != ''">
      AND recipe.recipe_name LIKE #{keyword}
    </if>
    <if test="eatType != null">
      AND items.recipe_type = #{eatType}
    </if>
    <if test="categoryId != 0">
      AND recipe.category_id = #{categoryId}
    </if>
    limit #{offSet},#{pageSize}
  </select>

  <update id="updateRecipePlanSurPlus">
    update t_recipe_planitems set surplus = #{surplus,jdbcType=INTEGER}
    where recipe_plan_id = #{recipePlanId} AND recipe_id = #{recipeId} AND recipe_type = #{eatType}
  </update>

  <!--修改库存-->
  <update id="updateSurPlus">
    update t_recipe_planitems set surplus =surplus+#{surplus,jdbcType=INTEGER}
    where recipe_plan_id = #{recipePlanId} AND recipe_id = #{recipeId} AND recipe_type = #{eatType}
  </update>

  <select id="getPlanItemsApp"  resultType="java.util.HashMap">
    select
    recipe.id  as id,recipe.recipe_name as name
    from t_recipe_planitems items
    INNER JOIN t_recipe recipe ON recipe.recipe_id = items.recipe_id
    where  recipe_plan_id =  #{recipePlanId}
    <if test="recipeType != null">
      AND items.recipe_type = #{recipeType}
    </if>
  </select>

</mapper>