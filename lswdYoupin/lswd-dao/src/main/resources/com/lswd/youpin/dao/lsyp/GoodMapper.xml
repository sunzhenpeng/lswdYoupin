<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lswd.youpin.dao.lsyp.GoodMapper">
  <resultMap id="BaseResultMap" type="com.lswd.youpin.model.lsyp.Good">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="good_id" jdbcType="VARCHAR" property="goodId" />
    <result column="good_name" jdbcType="VARCHAR" property="goodName" />
    <result column="price" jdbcType="REAL" property="price"/>
    <result column="market_price" jdbcType="REAL" property="marketPrice"/>
    <result column="imageurl" jdbcType="VARCHAR" property="imageurl" />
    <result column="bigimageurl" jdbcType="VARCHAR" property="bigimageurl" />
    <result column="supplier_id" jdbcType="VARCHAR" property="supplierId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="canteen_id" jdbcType="VARCHAR" property="canteenId" />
    <result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="cancel" jdbcType="BIT" property="cancel" />
    <result column="is_delete" jdbcType="BIT" property="isDelete" />
    <result column="standard" jdbcType="VARCHAR" property="standard" />
    <result column="unit" jdbcType="INTEGER" property="unit" />
    <result column="status" jdbcType="SMALLINT" property="status" />
    <result column="create_user" jdbcType="VARCHAR" property="createUser" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_user" jdbcType="VARCHAR" property="updateUser" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="safetyone" jdbcType="VARCHAR" property="safetyone" />
    <result column="safetytwo" jdbcType="VARCHAR" property="safetytwo" />
    <result column="safetythree" jdbcType="VARCHAR" property="safetythree" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, good_id, good_name,price, market_price, imageurl, bigimageurl,supplier_id, category_id,surplus,canteen_id, start_time, end_time,
    is_delete,standard, unit,status, create_user,create_time,update_user,update_time, description, safetyone, safetytwo, safetythree
  </sql>

  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_good
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from t_good
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.lswd.youpin.model.lsyp.Good">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into t_good (id, good_id, good_name, price,market_price,
      imageurl, bigimageurl,supplier_id, category_id,surplus, canteen_id,
      start_time, end_time, is_delete,standard, unit,
      status, update_user,update_time,create_user,
      create_time description,
      safetyone, safetytwo, safetythree
      )
    values (#{id,jdbcType=INTEGER}, #{goodId,jdbcType=VARCHAR}, #{goodName,jdbcType=VARCHAR}, #{price,jdbcType=REAL},#{marketPrice,jdbcType=REAL},
      #{imageurl,jdbcType=VARCHAR}, #{bigimageurl,jdbcType=VARCHAR},#{supplierId,jdbcType=VARCHAR}, #{categoryId,jdbcType=INTEGER},#{surplus,jdbcType=INTEGER},#{canteenId,jdbcType=VARCHAR},
      #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, #{isDelete,jdbcType=BIT},#{standard,jdbcType=VARCHAR}, #{unit,jdbcType=INTEGER},
      #{status,jdbcType=SMALLINT}, #{updateUser,jdbcType=VARCHAR},#{updateTime,jdbcType=TIMESTAMP},
      #{createUser,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},#{description,jdbcType=VARCHAR},
      #{safetyone,jdbcType=VARCHAR}, #{safetytwo,jdbcType=VARCHAR}, #{safetythree,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.lswd.youpin.model.lsyp.Good">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into t_good
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="goodId != null">
        good_id,
      </if>
      <if test="goodName != null">
        good_name,
      </if>
      <if test="price != null">
      price,
      </if>
      <if test="market_price != null">
        market_price,
      </if>
      <if test="imageurl != null">
        imageurl,
      </if>
      <if test="bigimageurl != null">
        bigimageurl,
      </if>
      <if test="supplierId != null">
        supplier_id,
      </if>
      <if test="categoryId != null">
        category_id,
      </if>
      <if test="surplus != null">
        surplus,
      </if>
      <if test="canteenId != null">
        canteen_id,
      </if>
      <if test="startTime != null">
        start_time,
      </if>
      <if test="endTime != null">
        end_time,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
      <if test="standard != null">
        standard,
      </if>
      <if test="unit != null">
        unit,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="safetyone != null">
        safetyone,
      </if>
      <if test="safetytwo != null">
        safetytwo,
      </if>
      <if test="safetythree != null">
        safetythree,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="goodId != null">
        #{goodId,jdbcType=VARCHAR},
      </if>
      <if test="goodName != null">
        #{goodName,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        #{price,jdbcType=REAL},
      </if>
      <if test="marketPrice != null">
        #{marketPrice,jdbcType=REAL},
      </if>
      <if test="imageurl != null">
        #{imageurl,jdbcType=VARCHAR},
      </if>
      <if test="bigimageurl != null">
        #{bigimageurl,jdbcType=VARCHAR},
      </if>
      <if test="supplierId != null">
        #{supplierId,jdbcType=VARCHAR},
      </if>
      <if test="categoryId != null">
        #{categoryId,jdbcType=INTEGER},
      </if>
      <if test="surplus != null">
        #{surplus,jdbcType=INTEGER},
      </if>
      <if test="canteenId != null">
        #{canteenId,jdbcType=VARCHAR},
      </if>
      <if test="startTime != null">
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=BIT},
      </if>
      <if test="standard != null">
        #{standard,jdbcType=VARCHAR},
      </if>
      <if test="unit != null">
        #{unit,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        #{status,jdbcType=SMALLINT},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="safetyone != null">
        #{safetyone,jdbcType=VARCHAR},
      </if>
      <if test="safetytwo != null">
        #{safetytwo,jdbcType=VARCHAR},
      </if>
      <if test="safetythree != null">
        #{safetythree,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lswd.youpin.model.lsyp.Good">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update t_good
    <set>
      <if test="goodId != null">
        good_id = #{goodId,jdbcType=VARCHAR},
      </if>
      <if test="goodName != null">
        good_name = #{goodName,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=REAL},
      </if>
      <if test="marketPrice != null">
        market_price = #{marketPrice,jdbcType=REAL},
      </if>
      <if test="imageurl != null">
        imageurl = #{imageurl,jdbcType=VARCHAR},
      </if>
      <if test="bigimageurl != null">
        bigimageurl = #{bigimageurl,jdbcType=VARCHAR},
      </if>
      <if test="supplierId != null">
        supplier_id = #{supplierId,jdbcType=VARCHAR},
      </if>
      <if test="categoryId != null">
        category_id = #{categoryId,jdbcType=INTEGER},
      </if>
      <if test="surplus != null">
        surplus = #{surplus,jdbcType=INTEGER},
      </if>
      <if test="canteenId != null">
        canteen_id = #{canteenId,jdbcType=VARCHAR},
      </if>
      <if test="startTime != null">
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        end_time = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        is_delete = #{isDelete,jdbcType=BIT},
     </if>
      <if test="standard != null">
        standard = #{standard,jdbcType=VARCHAR},
      </if>
      <if test="unit != null">
        unit = #{unit,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=SMALLINT},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="safetyone != null">
        safetyone = #{safetyone,jdbcType=VARCHAR},
      </if>
      <if test="safetytwo != null">
        safetytwo = #{safetytwo,jdbcType=VARCHAR},
      </if>
      <if test="safetythree != null">
        safetythree = #{safetythree,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lswd.youpin.model.lsyp.Good">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update t_good
    set good_id = #{goodId,jdbcType=VARCHAR},
      good_name = #{goodName,jdbcType=VARCHAR},
      price = #{price,jdbcType=REAL},
      market_price = #{marketPrice,jdbcType=REAL},
      imageurl = #{imageurl,jdbcType=VARCHAR},
      bigimageurl = #{bigimageurl,jdbcType=VARCHAR},
      supplier_id = #{supplierId,jdbcType=VARCHAR},
      category_id = #{categoryId,jdbcType=INTEGER},
      surplus = #{surplus,jdbcType=INTEGER},
      canteen_id = #{canteenId,jdbcType=VARCHAR},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      end_time = #{endTime,jdbcType=TIMESTAMP},
      is_delete = #{isDelete,jdbcType=BIT},
      standard = #{standard,jdbcType=VARCHAR},
      unit = #{unit,jdbcType=INTEGER},
      status = #{status,jdbcType=SMALLINT},
      update_user = #{updateUser,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      create_user = #{createUser,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      description = #{description,jdbcType=VARCHAR},
      safetyone = #{safetyone,jdbcType=VARCHAR},
      safetytwo = #{safetytwo,jdbcType=VARCHAR},
      safetythree = #{safetythree,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <!--从下面开始都是zhenguanqi写的-->
  <insert id="insertGood" parameterType="com.lswd.youpin.model.lsyp.Good">
  INSERT INTO  t_good(good_id,good_name,price,market_price,imageurl,bigimageurl,
    supplier_id,category_id,surplus,canteen_id,start_time,end_time,is_delete,standard,unit,status,create_user,create_time,update_user,update_time,description)
  VALUES (#{goodId,jdbcType=VARCHAR}, #{goodName,jdbcType=VARCHAR}, #{price,jdbcType=REAL},#{marketPrice,jdbcType=REAL},
    #{imageurl,jdbcType=VARCHAR}, #{bigimageurl,jdbcType=VARCHAR},#{supplierId,jdbcType=VARCHAR}, #{categoryId,jdbcType=INTEGER},#{surplus,jdbcType=INTEGER},#{canteenId,jdbcType=VARCHAR},
    #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, #{isDelete,jdbcType=BIT},#{standard,jdbcType=VARCHAR},#{unit,jdbcType=INTEGER},
    #{status,jdbcType=SMALLINT},#{createUser,jdbcType=VARCHAR},#{createTime,jdbcType=TIMESTAMP},
    #{updateUser,jdbcType=VARCHAR},#{updateTime,jdbcType=TIMESTAMP},
    #{description,jdbcType=VARCHAR})
  </insert>

  <!--商品列表不显示该商品，不是删除，因为之前的商品关联到了订单-->
  <delete id="deleteGoodCancel" parameterType="java.lang.Integer">
    update t_good  SET cancel = 1 where id = #{id,jdbcType=INTEGER}
  </delete>

  <!--商品下架,  status 1：表示商品过期，2：表示商品下架-->
  <delete id="delGoodDownById" parameterType="java.lang.Integer">
     update t_good  SET status = 2 ,is_delete = 1 where id = #{id,jdbcType=INTEGER}
  </delete>

  <!--商品过期-->
  <update id="updateGoodIsDeleteById" parameterType="java.lang.Integer">
    update t_good  SET status = 1 ,is_delete = 1  where id = #{id,jdbcType=INTEGER}
  </update>

  <update id="updateGood" parameterType="com.lswd.youpin.model.lsyp.Good">
    update t_good
    set good_name = #{goodName,jdbcType=VARCHAR},
        price = #{price,jdbcType=REAL},
        market_price = #{marketPrice,jdbcType=REAL},
        imageurl = #{imageurl,jdbcType=VARCHAR},
        bigimageurl = #{bigimageurl,jdbcType=VARCHAR},
        supplier_id = #{supplierId,jdbcType=VARCHAR},
        category_id = #{categoryId,jdbcType=INTEGER},
        surplus = #{surplus,jdbcType=INTEGER},
        canteen_id = #{canteenId,jdbcType=VARCHAR},
        standard = #{standard,jdbcType=VARCHAR},
        unit = #{unit,jdbcType=INTEGER},
        start_time = #{startTime,jdbcType=TIMESTAMP},
        end_time = #{endTime,jdbcType=TIMESTAMP},
        update_user = #{updateUser,jdbcType=VARCHAR},
        update_time = #{updateTime,jdbcType=TIMESTAMP},
        description = #{description,jdbcType=VARCHAR}
    where good_id = #{goodId}
  </update>

  <!--WEB画面请求的方法，商品展示的两个方法-->
  <select id="getGoodCount" resultType="java.lang.Integer">
    SELECT COUNT(1)  from t_good good INNER JOIN t_units ON good.unit = t_units.id
    WHERE 1=1  AND good.is_delete = 0  AND good.status = 0 AND good.cancel = 0
    <if test="keyword != '' ">
      AND good.good_name LIKE  #{keyword}
    </if>
    <if test="supplierId != '' ">
      AND good.supplier_id =  #{supplierId}
    </if>
    <if test="categoryId != null ">
      AND good.category_id =  #{categoryId}
    </if>
    <if test="canteenId != '' ">
      AND good.canteen_id =  #{canteenId}
    </if>
    <if test="canteenId == '' ">
      AND
      <foreach collection="canteenIds" item="can"  separator="OR" open="(" close=")">
        canteen_id=#{can,jdbcType=VARCHAR}
      </foreach>
    </if>
  </select>

  <!--resultMap：指向上面定义的resultMap标签下的id属性-->
  <resultMap id="selectGoodListMap" type="com.lswd.youpin.model.lsyp.Good">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="good_id" jdbcType="VARCHAR" property="goodId" />
    <result column="good_name" jdbcType="VARCHAR" property="goodName" />
    <result column="price" jdbcType="REAL" property="price"/>
    <result column="market_price" jdbcType="REAL" property="marketPrice"/>
    <result column="imageurl" jdbcType="VARCHAR" property="imageurl" />
    <result column="bigimageurl" jdbcType="VARCHAR" property="bigimageurl" />
    <result column="supplier_id" jdbcType="VARCHAR" property="supplierId" />
    <result column="category_id" jdbcType="INTEGER" property="categoryId" />
    <result column="surplus" jdbcType="INTEGER" property="surplus" />
    <result column="canteen_id" jdbcType="VARCHAR" property="canteenId" />
    <result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="is_delete" jdbcType="BIT" property="isDelete" />
    <result column="unit" jdbcType="INTEGER" property="unit" />
    <result column="status" jdbcType="SMALLINT" property="status" />
    <result column="create_user" jdbcType="VARCHAR" property="createUser" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="standard" jdbcType="VARCHAR" property="standard" />
  </resultMap>

  <select id="getGoodList" resultMap="selectGoodListMap">
    select good.id,good.good_id,good.good_name,good.price,good.market_price,good.imageurl,good.bigimageurl,good.supplier_id,good.category_id,good.surplus,good.unit,
        good.canteen_id,good.start_time,good.end_time,good.is_delete,good.standard,good.status,good.create_user,good.create_time,good.description,t_units.units unitName
    from t_good good
    LEFT JOIN t_units ON good.unit = t_units.id WHERE 1=1  AND good.is_delete = 0  AND good.status = 0 AND good.cancel = 0
    <if test="keyword != '' ">
      AND good.good_name LIKE  #{keyword}
    </if>
    <if test="supplierId != '' ">
      AND good.supplier_id =  #{supplierId}
    </if>
    <if test="categoryId != null ">
      AND good.category_id =  #{categoryId}
    </if>
    <if test="canteenId != '' ">
      AND good.canteen_id =  #{canteenId}
    </if>
    <if test="canteenId == '' ">
     AND
      <foreach collection="canteenIds" item="can"  separator="OR" open="(" close=")">
        canteen_id=#{can,jdbcType=VARCHAR}
      </foreach>
    </if>
    ORDER BY good.good_name ASC
    limit #{offSet},#{pageSize}
  </select>

  <select id="getGoodByGoodId" resultType="com.lswd.youpin.model.lsyp.Good" parameterType="java.lang.String">
    select t_good.id,t_good.good_id goodId,t_good.good_name goodName,t_good.price price,t_good.market_price marketPrice,t_good.standard standard,t_good.surplus,
    t_good.imageurl imageurl,t_good.bigimageurl bigimageurl,t_good.end_time endTime,t_good.description,t_good.supplier_id supplierId,t_units.units unitName,t_good.canteen_id
    from t_good INNER JOIN t_units ON t_good.unit = t_units.id where  good_id = #{goodid}
  </select>

  <select id="getMaxId" resultType="java.lang.Integer">
    select MAX(id)  from t_good
  </select>

  <!--resultMap：指向上面定义的resultMap标签下的id属性-->
  <resultMap id="getGoodMINIListMap" type="com.lswd.youpin.model.lsyp.Good">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="good_id" jdbcType="VARCHAR" property="goodId" />
    <result column="good_name" jdbcType="VARCHAR" property="goodName" />
    <result column="price" jdbcType="REAL" property="price"/>
    <result column="market_price" jdbcType="REAL" property="marketPrice"/>
    <result column="standard" jdbcType="VARCHAR" property="standard" />
  </resultMap>

  <!--商品计划新增时需要请求的方法-->
  <select id="getGoodMINICount" resultType="java.lang.Integer">
    SELECT COUNT(1)  from t_good good
    WHERE 1=1  AND good.is_delete = 0  AND good.status = 0 AND good.canteen_id =  #{canteenId} AND good.end_time >= #{pickingTime} AND good.cancel = 0
    <if test="keyword != '' ">
      AND good.good_name LIKE  #{keyword}
    </if>
    <if test="supplierId != '' ">
      AND good.supplier_id =  #{supplierId}
    </if>
    <if test="categoryId != null ">
      AND good.category_id =  #{categoryId}
    </if>
  </select>

  <select id="getGoodMINIList" resultMap="getGoodMINIListMap">
    select good.id,good.good_id,good.good_name,good.price,good.market_price,good.surplus,good.standard from t_good good
    WHERE 1=1  AND good.is_delete = 0  AND good.status = 0 AND good.canteen_id =  #{canteenId} AND good.end_time >= #{pickingTime} AND good.cancel = 0
    <if test="keyword != '' ">
      AND good.good_name LIKE  #{keyword}
    </if>
    <if test="supplierId != '' ">
      AND good.supplier_id =  #{supplierId}
    </if>
    <if test="categoryId != null ">
      AND good.category_id =  #{categoryId}
    </if>
    ORDER BY category_id ASC, good.good_name ASC , good.price ASC
    limit #{offSet},#{pageSize}
  </select>

  <update id="updateGoodSurPlus">
      update t_good set surplus = #{surplus,jdbcType=INTEGER} where good_id = #{goodId}
  </update>

</mapper>