<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lswd.youpin.dao.lsyp.CarMapper">
    <resultMap id="BaseResultMap" type="com.lswd.youpin.model.lsyp.Car">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="number" jdbcType="INTEGER" property="number" />
        <result column="is_type" jdbcType="BIT" property="isType" />
        <result column="canteen_id" jdbcType="VARCHAR" property="canteenId" />
        <result column="good_id" jdbcType="VARCHAR" property="goodId" />
        <result column="plan_id" jdbcType="VARCHAR" property="planId" />
        <result column="pick_time" jdbcType="TIMESTAMP" property="pickTime" />
        <result column="pick_type" jdbcType="INTEGER" property="recipeType" />
    </resultMap>


    <insert id="insertCar" parameterType="com.lswd.youpin.model.lsyp.Car">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_cart( associator_id, good_id,plan_id,
        quantity, is_delete,pick_time,pick_type,update_time,create_time,is_type,canteen_id)
        values ( #{associatorId,jdbcType=VARCHAR}, #{goodId,jdbcType=VARCHAR},#{planId,jdbcType=VARCHAR},
        #{number,jdbcType=INTEGER}, #{isDelete,jdbcType=BIT},#{pickTime,jdbcType=TIMESTAMP}, #{recipeType,jdbcType=INTEGER},
        #{updateTime,jdbcType=TIMESTAMP} ,#{createTime,jdbcType=TIMESTAMP},
        #{isType,jdbcType=BIT}, #{canteenId,jdbcType=VARCHAR})
    </insert>

    <delete id="deleteById" parameterType="com.lswd.youpin.model.lsyp.Car">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        DELETE from t_cart where id = #{id,jdbcType=INTEGER}
    </delete>

    <update id="updateById" parameterType="com.lswd.youpin.model.lsyp.Car">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_cart
        set
        quantity= #{number,jdbcType=INTEGER},
        update_time = #{updateTime,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=INTEGER}
    </update>
    <select id="getCarCount" parameterType="com.lswd.youpin.model.Associator" resultType="java.lang.Integer">
        SELECT COUNT(co.id) FROM (select *from t_cart as c
         where c.associator_id =#{associatorId,jdbcType=VARCHAR} AND c.canteen_id=#{canteenId,jdbcType=VARCHAR}
         and  c.is_delete=0 )
         as co
    </select>

    <select id="selectByAssociatorId"  resultMap="BaseResultMap">
        select c.id as id,c.quantity as number,c.plan_id as plan_id,
        c.is_type as is_type,c.canteen_id as canteen_id,c.good_id as good_id,c.pick_time as pick_time,c.pick_type as pick_type
        FROM t_cart as c WHERE  c.associator_id =#{associator.associatorId,jdbcType=VARCHAR}
        AND c.is_delete=0 AND c.canteen_id=#{associator.canteenId,jdbcType=VARCHAR}
        limit #{offSet},#{pageSize}
    </select>

    <select id="selectCarByGid"  resultMap="BaseResultMap">
        select c.id as id,SUM(c.quantity) as number,
        c.is_type as is_type,c.canteen_id as canteen_id,c.good_id as good_id
        from t_cart as c
        where  c.associator_id =#{associatorId,jdbcType=VARCHAR} and c.is_delete=0
        AND  c.good_id=#{goodId,jdbcType=VARCHAR} AND c.canteen_id=#{canteenId,jdbcType=VARCHAR}
        AND  c.pick_time=#{pickTime,jdbcType=TIMESTAMP} AND c.pick_type=#{recipeType,jdbcType=INTEGER}
        GROUP BY c.good_id
    </select>

</mapper>