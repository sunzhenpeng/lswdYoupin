<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lswd.youpin.dao.lsyp.CounterOrderMapper">
  <resultMap id="BaseResultMap" type="com.lswd.youpin.model.lsyp.CounterOrder">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="order_name" jdbcType="VARCHAR" property="orderName" />
    <result column="member_id" jdbcType="VARCHAR" property="memberId" />
    <result column="member_name" jdbcType="VARCHAR" property="memberName" />
    <result column="member_carduid" jdbcType="VARCHAR" property="memberCarduid" />
    <result column="counter_id" jdbcType="VARCHAR" property="counterId" />
    <result column="receivable_amount" jdbcType="REAL" property="receivableAmount" />
    <result column="discount_amount" jdbcType="REAL" property="discountAmount" />
    <result column="received_amount" jdbcType="REAL" property="receivedAmount" />
    <result column="balance" jdbcType="REAL" property="balance" />
    <result column="status" jdbcType="SMALLINT" property="status" />
    <result column="pay_time" jdbcType="TIMESTAMP" property="payTime" />
    <result column="pay_type" jdbcType="SMALLINT" property="payType" />
    <result column="number_table" jdbcType="INTEGER" property="numberTable" />
    <result column="number_people" jdbcType="INTEGER" property="numberPeople" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="counter_user" jdbcType="VARCHAR" property="counterUser" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="safetythree" jdbcType="VARCHAR" property="safetythree" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, order_id, order_name, member_id, member_name, member_carduid, counter_id, receivable_amount, 
    discount_amount, received_amount, balance, status, pay_time, pay_type, number_table, 
    number_people, description, counter_user, create_time, update_time, safetythree
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from dh_counter_order
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from dh_counter_order
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.lswd.youpin.model.lsyp.CounterOrder">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into dh_counter_order (id, order_id, order_name, 
      member_id, member_name, member_carduid, 
      counter_id, receivable_amount, discount_amount, 
      received_amount, balance, status, 
      pay_time, pay_type, number_table, 
      number_people, description, counter_user, 
      create_time, update_time, safetythree
      )
    values (#{id,jdbcType=INTEGER}, #{orderId,jdbcType=VARCHAR}, #{orderName,jdbcType=VARCHAR}, 
      #{memberId,jdbcType=VARCHAR}, #{memberName,jdbcType=VARCHAR}, #{memberCarduid,jdbcType=VARCHAR}, 
      #{counterId,jdbcType=VARCHAR}, #{receivableAmount,jdbcType=REAL}, #{discountAmount,jdbcType=REAL}, 
      #{receivedAmount,jdbcType=REAL}, #{balance,jdbcType=REAL}, #{status,jdbcType=SMALLINT}, 
      #{payTime,jdbcType=TIMESTAMP}, #{payType,jdbcType=SMALLINT}, #{numberTable,jdbcType=INTEGER}, 
      #{numberPeople,jdbcType=INTEGER}, #{description,jdbcType=VARCHAR}, #{counterUser,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, #{safetythree,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.lswd.youpin.model.lsyp.CounterOrder">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into dh_counter_order
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="orderId != null">
        order_id,
      </if>
      <if test="orderName != null">
        order_name,
      </if>
      <if test="memberId != null">
        member_id,
      </if>
      <if test="memberName != null">
        member_name,
      </if>
      <if test="memberCarduid != null">
        member_carduid,
      </if>
      <if test="counterId != null">
        counter_id,
      </if>
      <if test="receivableAmount != null">
        receivable_amount,
      </if>
      <if test="discountAmount != null">
        discount_amount,
      </if>
      <if test="receivedAmount != null">
        received_amount,
      </if>
      <if test="balance != null">
        balance,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="payTime != null">
        pay_time,
      </if>
      <if test="payType != null">
        pay_type,
      </if>
      <if test="numberTable != null">
        number_table,
      </if>
      <if test="numberPeople != null">
        number_people,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="counterUser != null">
        counter_user,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="safetythree != null">
        safetythree,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="orderId != null">
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="orderName != null">
        #{orderName,jdbcType=VARCHAR},
      </if>
      <if test="memberId != null">
        #{memberId,jdbcType=VARCHAR},
      </if>
      <if test="memberName != null">
        #{memberName,jdbcType=VARCHAR},
      </if>
      <if test="memberCarduid != null">
        #{memberCarduid,jdbcType=VARCHAR},
      </if>
      <if test="counterId != null">
        #{counterId,jdbcType=VARCHAR},
      </if>
      <if test="receivableAmount != null">
        #{receivableAmount,jdbcType=REAL},
      </if>
      <if test="discountAmount != null">
        #{discountAmount,jdbcType=REAL},
      </if>
      <if test="receivedAmount != null">
        #{receivedAmount,jdbcType=REAL},
      </if>
      <if test="balance != null">
        #{balance,jdbcType=REAL},
      </if>
      <if test="status != null">
        #{status,jdbcType=SMALLINT},
      </if>
      <if test="payTime != null">
        #{payTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payType != null">
        #{payType,jdbcType=SMALLINT},
      </if>
      <if test="numberTable != null">
        #{numberTable,jdbcType=INTEGER},
      </if>
      <if test="numberPeople != null">
        #{numberPeople,jdbcType=INTEGER},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="counterUser != null">
        #{counterUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="safetythree != null">
        #{safetythree,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lswd.youpin.model.lsyp.CounterOrder">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update dh_counter_order
    <set>
      <if test="orderId != null">
        order_id = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="orderName != null">
        order_name = #{orderName,jdbcType=VARCHAR},
      </if>
      <if test="memberId != null">
        member_id = #{memberId,jdbcType=VARCHAR},
      </if>
      <if test="memberName != null">
        member_name = #{memberName,jdbcType=VARCHAR},
      </if>
      <if test="memberCarduid != null">
        member_carduid = #{memberCarduid,jdbcType=VARCHAR},
      </if>
      <if test="counterId != null">
        counter_id = #{counterId,jdbcType=VARCHAR},
      </if>
      <if test="receivableAmount != null">
        receivable_amount = #{receivableAmount,jdbcType=REAL},
      </if>
      <if test="discountAmount != null">
        discount_amount = #{discountAmount,jdbcType=REAL},
      </if>
      <if test="receivedAmount != null">
        received_amount = #{receivedAmount,jdbcType=REAL},
      </if>
      <if test="balance != null">
        balance = #{balance,jdbcType=REAL},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=SMALLINT},
      </if>
      <if test="payTime != null">
        pay_time = #{payTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payType != null">
        pay_type = #{payType,jdbcType=SMALLINT},
      </if>
      <if test="numberTable != null">
        number_table = #{numberTable,jdbcType=INTEGER},
      </if>
      <if test="numberPeople != null">
        number_people = #{numberPeople,jdbcType=INTEGER},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="counterUser != null">
        counter_user = #{counterUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="safetythree != null">
        safetythree = #{safetythree,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lswd.youpin.model.lsyp.CounterOrder">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update dh_counter_order
    set order_id = #{orderId,jdbcType=VARCHAR},
      order_name = #{orderName,jdbcType=VARCHAR},
      member_id = #{memberId,jdbcType=VARCHAR},
      member_name = #{memberName,jdbcType=VARCHAR},
      member_carduid = #{memberCarduid,jdbcType=VARCHAR},
      counter_id = #{counterId,jdbcType=VARCHAR},
      receivable_amount = #{receivableAmount,jdbcType=REAL},
      discount_amount = #{discountAmount,jdbcType=REAL},
      received_amount = #{receivedAmount,jdbcType=REAL},
      balance = #{balance,jdbcType=REAL},
      status = #{status,jdbcType=SMALLINT},
      pay_time = #{payTime,jdbcType=TIMESTAMP},
      pay_type = #{payType,jdbcType=SMALLINT},
      number_table = #{numberTable,jdbcType=INTEGER},
      number_people = #{numberPeople,jdbcType=INTEGER},
      description = #{description,jdbcType=VARCHAR},
      counter_user = #{counterUser,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      safetythree = #{safetythree,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>



  <select id="getOrderListCountBT" resultType="com.lswd.youpin.model.vo.TotalCountMoney">
    select COUNT(1) AS totalCount,sum(received_amount) AS totalMoney  from dh_counter_order where 1=1 AND counter_id = #{counterId}  AND status = 0
    AND DATE_FORMAT(pay_time,'%Y-%m-%d') BETWEEN #{startDate} AND #{endDate}
    <if test="payType != null">
      AND pay_type = #{payType}
    </if>
  </select>

  <select id="getOrderListBT" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />,CASE pay_type WHEN 0 THEN '刷卡支付' WHEN 1 THEN '现金支付' WHEN 2 THEN '网络支付' END AS payTypeName
    from dh_counter_order where 1=1 AND counter_id = #{counterId}  AND status = 0
    AND DATE_FORMAT(pay_time,'%Y-%m-%d') BETWEEN #{startDate} AND #{endDate}
    <if test="payType != null">
      AND pay_type = #{payType}
    </if>
    ORDER BY pay_time DESC
    limit #{offSet},#{pageSize}
  </select>

  <select id="getMemberOrderListCount" resultType="com.lswd.youpin.model.vo.TotalCountMoney">
    select COUNT(1) AS totalCount,sum(received_amount) AS totalMoney,sum(receivable_amount) AS totalReceivableMoney  from dh_counter_order where 1=1 AND counter_id = #{counterId} AND status = 0
    <if test="memberName != ''">
      AND member_name LIKE concat('%',#{memberName},'%')
    </if>
    <if test="memberCardUid != ''">
      AND member_carduid LIKE concat('%',#{memberCardUid},'%')
    </if>
    ORDER BY pay_time DESC
  </select>

  <select id="getMemberOrderList" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />,CASE pay_type WHEN 0 THEN '刷卡支付' WHEN 1 THEN '现金支付' WHEN 2 THEN '网络支付' END AS payTypeName
    from dh_counter_order where 1=1 AND counter_id = #{counterId} AND status = 0
    <if test="memberName != ''">
      AND member_name LIKE concat('%',#{memberName},'%')
    </if>
    <if test="memberCardUid != ''">
      AND member_carduid LIKE concat('%',#{memberCardUid},'%')
    </if>
    ORDER BY pay_time DESC
    limit #{offSet},#{pageSize}
  </select>

  <resultMap id="getMemberOrderItemsMap" type="com.lswd.youpin.model.lsyp.CounterOrderItems">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="menu_id" jdbcType="VARCHAR" property="menuId" />
    <result column="menu_name" jdbcType="REAL" property="menuName" />
    <result column="menu_vip_price" jdbcType="REAL" property="menuVipPrice" />
    <result column="menu_market_price" jdbcType="REAL" property="menuMarketPrice" />
    <result column="menu_type_name" jdbcType="VARCHAR" property="menuTypeName" />
    <result column="quantity" jdbcType="INTEGER" property="quantity" />
    <result column="order_amount" jdbcType="REAL" property="orderAmount" />
    <result column="description" jdbcType="VARCHAR" property="description" />
  </resultMap>

  <select id="getMemberOrderItems" parameterType="java.lang.String" resultMap="getMemberOrderItemsMap">
    select   id, order_id, menu_id, menu_name, menu_vip_price, menu_market_price, menu_type_name,
    quantity, order_amount, description
    from dh_counter_order_items where order_id = #{orderId,jdbcType=VARCHAR}
  </select>


</mapper>